---
- hosts: all
  module_defaults:
    apt:
      force_apt_get: true
      update_cache: true
      cache_valid_time: 86400
  roles:
    - kotovalexarian.common

- hosts: partynest
  module_defaults:
    apt:
      force_apt_get: true
      update_cache: true
      cache_valid_time: 86400
  roles:
    - rvm.ruby
    - kotovalexarian.rails
  tasks:
    - name: Copy master encryption key
      copy:
        src: ../files/master.key
        dest: '{{ rails__root_dir }}/shared/config/master.key'
        owner: '{{ rails__deploy_user }}'
        group: '{{ rails__group }}'
        mode: 'u=rw,g=rw,o='
