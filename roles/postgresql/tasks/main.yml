---
- name: Install PostgreSQL
  apt:
    update_cache: true
    name: ['postgresql-10', 'python-psycopg2', 'python3-psycopg2']

- name: Host-based authentication config
  template:
    src: templates/pg_hba.conf
    dest: '/etc/postgresql/10/main/pg_hba.conf'
    mode: 'u=rw,g=r,o='
    owner: postgres
    group: postgres
  notify: Restart PostgreSQL

- name: Custom config
  template:
    src: templates/postgresql.conf
    dest: '/etc/postgresql/10/main/conf.d/postgresql.conf'
    mode: 'u=rw,g=r,o=r'
    owner: postgres
    group: postgres
  notify: Restart PostgreSQL
